---
uid: identity/overview/migrations/migrating-an-existing-website-from-sql-membership-to-aspnet-identity
title: SQL 멤버 자격에서 ASP.NET Id로 기존 웹 사이트를 마이그레이션 | Microsoft Docs
author: Rick-Anderson
description: 이 자습서에서는 사용자와 역할 데이터를 새 ASP.NET Id s로 SQL 멤버 자격을 사용 하 여 만든 기존 웹 응용 프로그램을 마이그레이션하는 단계를를 보여 줍니다...
ms.author: aspnetcontent
manager: wpickett
ms.date: 12/19/2014
ms.topic: article
ms.assetid: 220d3d75-16b2-4240-beae-a5b534f06419
ms.technology: ''
msc.legacyurl: /identity/overview/migrations/migrating-an-existing-website-from-sql-membership-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 7df2c9a6cccefd3c4f3022c14627394557543258
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 07/03/2018
ms.locfileid: "37389139"
---
<a name="migrating-an-existing-website-from-sql-membership-to-aspnet-identity"></a><span data-ttu-id="dbbca-103">SQL 멤버 자격에서 ASP.NET Id로 기존 웹 사이트를 마이그레이션</span><span class="sxs-lookup"><span data-stu-id="dbbca-103">Migrating an Existing Website from SQL Membership to ASP.NET Identity</span></span>
====================
<span data-ttu-id="dbbca-104">하 여 [Rick Anderson](https://github.com/Rick-Anderson), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="dbbca-104">by [Rick Anderson](https://github.com/Rick-Anderson), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="dbbca-105">이 자습서에서는 사용자와 역할 데이터를 SQL 멤버 자격을 사용 하 여 새 ASP.NET Id 시스템에 만든 기존 웹 응용 프로그램을 마이그레이션하는 단계를를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-105">This tutorial illustrates the steps to migrate an existing web application with user and role data created using SQL Membership to the new ASP.NET Identity system.</span></span> <span data-ttu-id="dbbca-106">이 방법은 ASP.NET Id와 후크를 기존/신규 클래스에 의해 필요한 하나에 기존 데이터베이스 스키마를 변경 하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-106">This approach involves changing the existing database schema to the one needed by the ASP.NET Identity and hook in the old/new classes to it.</span></span> <span data-ttu-id="dbbca-107">데이터베이스 마이그레이션되면이 방법을 채택 하면, 향후 업데이트에서 Id로 간편 하 게 처리 됩니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-107">After you adopt this approach, once your database is migrated, future updates to Identity will be handled effortlessly.</span></span>


<span data-ttu-id="dbbca-108">이 자습서에서는 데이터를 사용자 및 역할을 만들려면 Visual Studio 2010을 사용 하 여 만든 웹 응용 프로그램 템플릿 (Web Forms) 수행 됩니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-108">For this tutorial, we will take a web application template (Web Forms) created using Visual Studio 2010 to create user and role data.</span></span> <span data-ttu-id="dbbca-109">Id 시스템에 필요한 테이블에 기존 데이터베이스를 마이그레이션하려면 다음 SQL 스크립트 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-109">We will then use SQL scripts to migrate the existing database to tables needed by the Identity system.</span></span> <span data-ttu-id="dbbca-110">다음에서는 필요한 NuGet 패키지를 설치 하 고 멤버 자격 관리에 대 한 Id 시스템을 사용 하는 새 계정 관리 페이지를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-110">Next we'll install the necessary NuGet packages and add new account management pages which use the Identity system for membership management.</span></span> <span data-ttu-id="dbbca-111">마이그레이션 테스트를 SQL 멤버 자격을 사용 하 여 만든 사용자가 로그인 할 수 있어야 하 고 새 사용자를 등록할 수 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-111">As a test of migration, users created using SQL membership should be able to log in and new users should be able to register.</span></span> <span data-ttu-id="dbbca-112">전체 샘플을 찾을 수 있습니다 [여기](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/)합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-112">You can find the complete sample [here](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/).</span></span> <span data-ttu-id="dbbca-113">참고 항목 [ASP.NET 멤버 자격에서 ASP.NET Id로 마이그레이션](http://travis.io/blog/2015/03/24/migrate-from-aspnet-membership-to-aspnet-identity.html)합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-113">See also [Migrating from ASP.NET Membership to ASP.NET Identity](http://travis.io/blog/2015/03/24/migrate-from-aspnet-membership-to-aspnet-identity.html).</span></span>

## <a name="getting-started"></a><span data-ttu-id="dbbca-114">시작</span><span class="sxs-lookup"><span data-stu-id="dbbca-114">Getting started</span></span>

### <a name="creating-an-application-with-sql-membership"></a><span data-ttu-id="dbbca-115">SQL 멤버 자격을 사용 하 여 응용 프로그램 만들기</span><span class="sxs-lookup"><span data-stu-id="dbbca-115">Creating an application with SQL Membership</span></span>

1. <span data-ttu-id="dbbca-116">SQL 멤버 자격을 사용 하 여 사용자 및 역할 데이터를 포함 하는 기존 응용 프로그램을 시작 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-116">We need to start with an existing application that uses SQL membership and has user and role data.</span></span> <span data-ttu-id="dbbca-117">이 기사에서는 Visual Studio 2010에서 웹 응용 프로그램을 만들어 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-117">For the purpose of this article, let's create a web application in Visual Studio 2010.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="dbbca-118">ASP.NET 구성 도구를 사용 하 여 만들 2 명의 사용자: **oldAdminUser** 고 **oldUser 합니다.**</span><span class="sxs-lookup"><span data-stu-id="dbbca-118">Using the ASP.NET Configuration tool, create 2 users: **oldAdminUser** and **oldUser.**</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image1.png)

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image2.jpg)
3. <span data-ttu-id="dbbca-119">관리자 라는 역할을 만들고 해당 역할의 사용자로 'oldAdminUser'를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-119">Create a role named Admin and add 'oldAdminUser' as a user in that role.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image2.png)
4. <span data-ttu-id="dbbca-120">Default.aspx를 사용 하 여 사이트의 관리 섹션을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-120">Create an Admin section of the site with a Default.aspx.</span></span> <span data-ttu-id="dbbca-121">관리자 역할의 사용자 에게만 액세스를 사용 하도록 설정 하려면 web.config 파일에 권한 부여 태그를 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-121">Set the authorization tag in the web.config file to enable access only to users in Admin roles.</span></span> <span data-ttu-id="dbbca-122">자세한 내용은 여기에서 찾을 수 있습니다. [https://www.asp.net/web-forms/tutorials/security/roles/role-based-authorization-cs](../../../web-forms/overview/older-versions-security/roles/role-based-authorization-cs.md)</span><span class="sxs-lookup"><span data-stu-id="dbbca-122">More information can be found here [https://www.asp.net/web-forms/tutorials/security/roles/role-based-authorization-cs](../../../web-forms/overview/older-versions-security/roles/role-based-authorization-cs.md)</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image3.png)
5. <span data-ttu-id="dbbca-123">SQL 멤버 자격 시스템에서 만든 테이블을 이해 하려면 서버 탐색기에서 데이터베이스를 보고 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-123">View the database in Server Explorer to understand the tables created by the SQL membership system.</span></span> <span data-ttu-id="dbbca-124">사용자 로그인 데이터 aspnet에 저장 됩니다\_사용자 및 aspnet\_멤버 자격 테이블, 역할 데이터는 aspnet에 저장 하는 동안\_Roles 테이블입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-124">The user login data is stored in the aspnet\_Users and aspnet\_Membership tables, while role data is stored in the aspnet\_Roles table.</span></span> <span data-ttu-id="dbbca-125">에 대 한 사용자가 역할 aspnet에 저장 된 정보\_UsersInRoles 테이블입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-125">Information about which users are in which roles is stored in the aspnet\_UsersInRoles table.</span></span> <span data-ttu-id="dbbca-126">기본 멤버 자격 관리에 대 한 ASP.NET Id 시스템에 위의 테이블의 정보를 포트에 부족 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-126">For basic membership management it is sufficient to port the information in the above tables to the ASP.NET Identity system.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image4.png)

### <a name="migrating-to-visual-studio-2013"></a><span data-ttu-id="dbbca-127">Visual Studio 2013으로 마이그레이션</span><span class="sxs-lookup"><span data-stu-id="dbbca-127">Migrating to Visual Studio 2013</span></span>

1. <span data-ttu-id="dbbca-128">웹 또는와 함께 Visual Studio 2013 용 Visual Studio Express 2013을 설치 합니다 [최신 업데이트](https://www.microsoft.com/download/details.aspx?id=44921)합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-128">Install Visual Studio Express 2013 for Web or Visual Studio 2013 along with the [latest updates](https://www.microsoft.com/download/details.aspx?id=44921).</span></span>
2. <span data-ttu-id="dbbca-129">Visual Studio의 설치 된 버전에서 위의 프로젝트를 엽니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-129">Open the above project in your installed version of Visual Studio.</span></span> <span data-ttu-id="dbbca-130">SQL Server Express 설치 되어 있지 않으면 컴퓨터에서 연결 문자열에서 SQL Express를 사용 하므로 프로젝트를 열면 프롬프트가 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-130">If SQL Server Express is not installed on the machine, a prompt is displayed when you open the project, since the connection string uses SQL Express.</span></span> <span data-ttu-id="dbbca-131">SQL Express를 설치 하거나로 해결 변경 LocalDb 연결 문자열을 선택할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-131">You can either choose to install SQL Express or as work around change the connection string to LocalDb.</span></span> <span data-ttu-id="dbbca-132">이 문서에 대 한 LocalDb에 변경 됩니다 것입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-132">For this article we'll change it to LocalDb.</span></span>
3. <span data-ttu-id="dbbca-133">Web.config를 열고 연결 문자열을 변경 합니다. (LocalDb) v11.0 SQLExpess입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-133">Open web.config and change the connection string from .SQLExpess to (LocalDb)v11.0.</span></span> <span data-ttu-id="dbbca-134">제거할 ' 사용자 인스턴스 = true' 연결 문자열에서.</span><span class="sxs-lookup"><span data-stu-id="dbbca-134">Remove 'User Instance=true' from the connection string.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image3.jpg)
4. <span data-ttu-id="dbbca-135">서버 탐색기를 열고 테이블 스키마 및 데이터를 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-135">Open Server Explorer and verify that the table schema and data can be observed.</span></span>
5. <span data-ttu-id="dbbca-136">ASP.NET Id 시스템의 framework 4.5 이상 버전을 사용 하 여 작동합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-136">The ASP.NET Identity system works with version 4.5 or higher of the framework.</span></span> <span data-ttu-id="dbbca-137">4.5로 또는 그 이상 응용 프로그램 대상 다시 지정 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-137">Retarget the application to 4.5 or higher.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image5.png)

    <span data-ttu-id="dbbca-138">오류가 있는지 확인 하려면 프로젝트를 빌드하십시오.</span><span class="sxs-lookup"><span data-stu-id="dbbca-138">Build the project to verify that there are no errors.</span></span>

### <a name="installing-the-nuget-packages"></a><span data-ttu-id="dbbca-139">Nuget 패키지 설치</span><span class="sxs-lookup"><span data-stu-id="dbbca-139">Installing the Nuget packages</span></span>

1. <span data-ttu-id="dbbca-140">솔루션 탐색기에서 프로젝트를 마우스 오른쪽 단추로 &gt; **NuGet 패키지 관리**합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-140">In Solution Explorer, right-click the project &gt; **Manage NuGet Packages**.</span></span> <span data-ttu-id="dbbca-141">검색 상자에서 "Asp.net Id"를 입력 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-141">In the search box, enter "Asp.net Identity".</span></span> <span data-ttu-id="dbbca-142">결과 목록에서 패키지를 선택 하 고 설치를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-142">Select the package in the list of results and click install.</span></span> <span data-ttu-id="dbbca-143">"동의 안 함" 단추를 클릭 하 여 사용권 계약에 동의 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-143">Accept the license agreement by clicking on "I Accept" button.</span></span> <span data-ttu-id="dbbca-144">이 패키지 종속성 패키지 설치는 참고: EntityFramework 및 Microsoft Asp.net Identity입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-144">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span> <span data-ttu-id="dbbca-145">마찬가지로 (OAuth 로그인을 사용 하도록 설정 하지 않으려는 경우 마지막 4 OWIN 패키지 건너뜁니다) 다음 패키지를 설치 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-145">Similarly install the following packages (skip the last 4 OWIN packages if you don't want to enable OAuth log-in):</span></span>

   - <span data-ttu-id="dbbca-146">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="dbbca-146">Microsoft.AspNet.Identity.Owin</span></span>
   - <span data-ttu-id="dbbca-147">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="dbbca-147">Microsoft.Owin.Host.SystemWeb</span></span>
   - <span data-ttu-id="dbbca-148">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="dbbca-148">Microsoft.Owin.Security.Facebook</span></span>
   - <span data-ttu-id="dbbca-149">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="dbbca-149">Microsoft.Owin.Security.Google</span></span>
   - <span data-ttu-id="dbbca-150">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="dbbca-150">Microsoft.Owin.Security.MicrosoftAccount</span></span>
   - <span data-ttu-id="dbbca-151">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="dbbca-151">Microsoft.Owin.Security.Twitter</span></span>

     ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image6.png)

### <a name="migrate-database-to-the-new-identity-system"></a><span data-ttu-id="dbbca-152">새 Id 시스템으로 데이터베이스 마이그레이션</span><span class="sxs-lookup"><span data-stu-id="dbbca-152">Migrate database to the new Identity system</span></span>

<span data-ttu-id="dbbca-153">ASP.NET Id 시스템에 필요한 스키마에 기존 데이터베이스를 마이그레이션하려면 다음 단계가입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-153">The next step is to migrate the existing database to a schema required by the ASP.NET Identity system.</span></span> <span data-ttu-id="dbbca-154">달성 하기 위해 새 테이블을 만들고 새 테이블에 기존 사용자 정보를 마이그레이션해야 하는 명령 집합이 있는 스크립트 SQL을 실행 했습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-154">To achieve this we run a SQL script which has a set of commands to create new tables and migrate existing user information to the new tables.</span></span> <span data-ttu-id="dbbca-155">스크립트 파일을 찾을 수 있습니다 [여기](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/Migrations.sql)합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-155">The script file can be found [here](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/Migrations.sql).</span></span>

<span data-ttu-id="dbbca-156">이 스크립트 파일은이 샘플에 특정 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-156">This script file is specific to this sample.</span></span> <span data-ttu-id="dbbca-157">테이블에 대 한 스키마를 생성 하는 경우 사용자 지정 된 SQL 멤버 자격을 사용 하 여 또는 적절 하 게 변경 해야 스크립트를 수정 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-157">If the schema for the tables created using SQL membership is customized or modified the scripts need to be changed accordingly.</span></span>

### <a name="how-to-generate-the-sql-script-for-schema-migration"></a><span data-ttu-id="dbbca-158">스키마 마이그레이션에 대 한 SQL 스크립트를 생성 하는 방법</span><span class="sxs-lookup"><span data-stu-id="dbbca-158">How to generate the SQL script for schema migration</span></span>

<span data-ttu-id="dbbca-159">기존 사용자의 데이터를 사용 하 여 즉시 작동 하려면 ASP.NET Id 클래스에 대 한 ASP.NET Id에서 필요한 데이터베이스 스키마로 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-159">For ASP.NET Identity classes to work out of the box with the data of existing users, we need to migrate the database schema to the one needed by ASP.NET Identity.</span></span> <span data-ttu-id="dbbca-160">새 테이블을 추가 하 고 해당 테이블에 기존 정보를 복사 하 여이 작업을 수행 수입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-160">We can do this by adding new tables and copying the existing information to those tables.</span></span> <span data-ttu-id="dbbca-161">기본적으로 ASP.NET Id는 Id 모델 클래스 정보를 저장/검색 데이터베이스에 다시 매핑할 EntityFramework를 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-161">By default ASP.NET Identity uses EntityFramework to map the Identity model classes back to the database to store/retrieve information.</span></span> <span data-ttu-id="dbbca-162">이러한 모델 클래스는 사용자 및 역할 개체를 정의 하는 core Identity 인터페이스를 구현 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-162">These model classes implement the core Identity interfaces defining user and role objects.</span></span> <span data-ttu-id="dbbca-163">테이블 및 데이터베이스의 열에는 이러한 모델 클래스는 기반으로 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-163">The tables and the columns in the database are based on these model classes.</span></span> <span data-ttu-id="dbbca-164">EntityFramework 모델 클래스는 Identity v2.1.0 및 해당 속성에는 아래에서 정의 됨</span><span class="sxs-lookup"><span data-stu-id="dbbca-164">The EntityFramework model classes in Identity v2.1.0 and their properties are as defined below</span></span>

| <span data-ttu-id="dbbca-165">**IdentityUser**</span><span class="sxs-lookup"><span data-stu-id="dbbca-165">**IdentityUser**</span></span> | <span data-ttu-id="dbbca-166">**Type**</span><span class="sxs-lookup"><span data-stu-id="dbbca-166">**Type**</span></span> | <span data-ttu-id="dbbca-167">**IdentityRole**</span><span class="sxs-lookup"><span data-stu-id="dbbca-167">**IdentityRole**</span></span> | <span data-ttu-id="dbbca-168">**IdentityUserRole**</span><span class="sxs-lookup"><span data-stu-id="dbbca-168">**IdentityUserRole**</span></span> | <span data-ttu-id="dbbca-169">**IdentityUserLogin**</span><span class="sxs-lookup"><span data-stu-id="dbbca-169">**IdentityUserLogin**</span></span> | <span data-ttu-id="dbbca-170">**IdentityUserClaim**</span><span class="sxs-lookup"><span data-stu-id="dbbca-170">**IdentityUserClaim**</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="dbbca-171">ID</span><span class="sxs-lookup"><span data-stu-id="dbbca-171">Id</span></span> | <span data-ttu-id="dbbca-172">string</span><span class="sxs-lookup"><span data-stu-id="dbbca-172">string</span></span> | <span data-ttu-id="dbbca-173">ID</span><span class="sxs-lookup"><span data-stu-id="dbbca-173">Id</span></span> | <span data-ttu-id="dbbca-174">RoleId</span><span class="sxs-lookup"><span data-stu-id="dbbca-174">RoleId</span></span> | <span data-ttu-id="dbbca-175">ProviderKey</span><span class="sxs-lookup"><span data-stu-id="dbbca-175">ProviderKey</span></span> | <span data-ttu-id="dbbca-176">ID</span><span class="sxs-lookup"><span data-stu-id="dbbca-176">Id</span></span> |
| <span data-ttu-id="dbbca-177">사용자 이름</span><span class="sxs-lookup"><span data-stu-id="dbbca-177">Username</span></span> | <span data-ttu-id="dbbca-178">string</span><span class="sxs-lookup"><span data-stu-id="dbbca-178">string</span></span> | <span data-ttu-id="dbbca-179">name</span><span class="sxs-lookup"><span data-stu-id="dbbca-179">Name</span></span> | <span data-ttu-id="dbbca-180">UserId</span><span class="sxs-lookup"><span data-stu-id="dbbca-180">UserId</span></span> | <span data-ttu-id="dbbca-181">UserId</span><span class="sxs-lookup"><span data-stu-id="dbbca-181">UserId</span></span> | <span data-ttu-id="dbbca-182">ClaimType</span><span class="sxs-lookup"><span data-stu-id="dbbca-182">ClaimType</span></span> |
| <span data-ttu-id="dbbca-183">PasswordHash</span><span class="sxs-lookup"><span data-stu-id="dbbca-183">PasswordHash</span></span> | <span data-ttu-id="dbbca-184">string</span><span class="sxs-lookup"><span data-stu-id="dbbca-184">string</span></span> |  |  | <span data-ttu-id="dbbca-185">LoginProvider</span><span class="sxs-lookup"><span data-stu-id="dbbca-185">LoginProvider</span></span> | <span data-ttu-id="dbbca-186">ClaimValue</span><span class="sxs-lookup"><span data-stu-id="dbbca-186">ClaimValue</span></span> |
| <span data-ttu-id="dbbca-187">SecurityStamp</span><span class="sxs-lookup"><span data-stu-id="dbbca-187">SecurityStamp</span></span> | <span data-ttu-id="dbbca-188">string</span><span class="sxs-lookup"><span data-stu-id="dbbca-188">string</span></span> |  |  |  | <span data-ttu-id="dbbca-189">사용자\_Id</span><span class="sxs-lookup"><span data-stu-id="dbbca-189">User\_Id</span></span> |
| <span data-ttu-id="dbbca-190">메일</span><span class="sxs-lookup"><span data-stu-id="dbbca-190">Email</span></span> | <span data-ttu-id="dbbca-191">string</span><span class="sxs-lookup"><span data-stu-id="dbbca-191">string</span></span> |  |  |  |  |
| <span data-ttu-id="dbbca-192">EmailConfirmed</span><span class="sxs-lookup"><span data-stu-id="dbbca-192">EmailConfirmed</span></span> | <span data-ttu-id="dbbca-193">bool</span><span class="sxs-lookup"><span data-stu-id="dbbca-193">bool</span></span> |  |  |  |  |
| <span data-ttu-id="dbbca-194">전화 번호</span><span class="sxs-lookup"><span data-stu-id="dbbca-194">PhoneNumber</span></span> | <span data-ttu-id="dbbca-195">string</span><span class="sxs-lookup"><span data-stu-id="dbbca-195">string</span></span> |  |  |  |  |
| <span data-ttu-id="dbbca-196">PhoneNumberConfirmed</span><span class="sxs-lookup"><span data-stu-id="dbbca-196">PhoneNumberConfirmed</span></span> | <span data-ttu-id="dbbca-197">bool</span><span class="sxs-lookup"><span data-stu-id="dbbca-197">bool</span></span> |  |  |  |  |
| <span data-ttu-id="dbbca-198">LockoutEnabled</span><span class="sxs-lookup"><span data-stu-id="dbbca-198">LockoutEnabled</span></span> | <span data-ttu-id="dbbca-199">bool</span><span class="sxs-lookup"><span data-stu-id="dbbca-199">bool</span></span> |  |  |  |  |
| <span data-ttu-id="dbbca-200">LockoutEndDate</span><span class="sxs-lookup"><span data-stu-id="dbbca-200">LockoutEndDate</span></span> | <span data-ttu-id="dbbca-201">DateTime</span><span class="sxs-lookup"><span data-stu-id="dbbca-201">DateTime</span></span> |  |  |  |  |
| <span data-ttu-id="dbbca-202">AccessFailedCount</span><span class="sxs-lookup"><span data-stu-id="dbbca-202">AccessFailedCount</span></span> | <span data-ttu-id="dbbca-203">int</span><span class="sxs-lookup"><span data-stu-id="dbbca-203">int</span></span> |  |  |  |  |

<span data-ttu-id="dbbca-204">속성에 해당 하는 열을 사용 하 여 각이 모델에 대 한 테이블을 하도록 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-204">We need to have tables for each of these models with columns corresponding to the properties.</span></span> <span data-ttu-id="dbbca-205">에 클래스 및 테이블 간의 매핑을 정의 합니다 `OnModelCreating` 메서드는 `IdentityDBContext`합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-205">The mapping between classes and tables is defined in the `OnModelCreating` method of the `IdentityDBContext`.</span></span> <span data-ttu-id="dbbca-206">이 구성의 fluent API 메서드 라고 하며 자세한 정보를 찾을 수 있습니다 [여기](https://msdn.microsoft.com/data/jj591617.aspx)합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-206">This is known as the fluent API method of configuration and more information can be found [here](https://msdn.microsoft.com/data/jj591617.aspx).</span></span> <span data-ttu-id="dbbca-207">클래스에 대 한 구성은 아래에 설명 된 대로</span><span class="sxs-lookup"><span data-stu-id="dbbca-207">The configuration for the classes is as mentioned below</span></span>

| <span data-ttu-id="dbbca-208">**클래스**</span><span class="sxs-lookup"><span data-stu-id="dbbca-208">**Class**</span></span> | <span data-ttu-id="dbbca-209">**Table**</span><span class="sxs-lookup"><span data-stu-id="dbbca-209">**Table**</span></span> | <span data-ttu-id="dbbca-210">**기본 키**</span><span class="sxs-lookup"><span data-stu-id="dbbca-210">**Primary key**</span></span> | <span data-ttu-id="dbbca-211">**외래 키**</span><span class="sxs-lookup"><span data-stu-id="dbbca-211">**Foreign key**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="dbbca-212">IdentityUser</span><span class="sxs-lookup"><span data-stu-id="dbbca-212">IdentityUser</span></span> | <span data-ttu-id="dbbca-213">AspnetUsers</span><span class="sxs-lookup"><span data-stu-id="dbbca-213">AspnetUsers</span></span> | <span data-ttu-id="dbbca-214">ID</span><span class="sxs-lookup"><span data-stu-id="dbbca-214">Id</span></span> |  |
| <span data-ttu-id="dbbca-215">IdentityRole</span><span class="sxs-lookup"><span data-stu-id="dbbca-215">IdentityRole</span></span> | <span data-ttu-id="dbbca-216">AspnetRoles</span><span class="sxs-lookup"><span data-stu-id="dbbca-216">AspnetRoles</span></span> | <span data-ttu-id="dbbca-217">ID</span><span class="sxs-lookup"><span data-stu-id="dbbca-217">Id</span></span> |  |
| <span data-ttu-id="dbbca-218">IdentityUserRole</span><span class="sxs-lookup"><span data-stu-id="dbbca-218">IdentityUserRole</span></span> | <span data-ttu-id="dbbca-219">AspnetUserRole</span><span class="sxs-lookup"><span data-stu-id="dbbca-219">AspnetUserRole</span></span> | <span data-ttu-id="dbbca-220">사용자 Id + RoleId</span><span class="sxs-lookup"><span data-stu-id="dbbca-220">UserId + RoleId</span></span> | <span data-ttu-id="dbbca-221">사용자\_Id-&gt;AspnetUsers RoleId-&gt;AspnetRoles</span><span class="sxs-lookup"><span data-stu-id="dbbca-221">User\_Id-&gt;AspnetUsers RoleId-&gt;AspnetRoles</span></span> |
| <span data-ttu-id="dbbca-222">IdentityUserLogin</span><span class="sxs-lookup"><span data-stu-id="dbbca-222">IdentityUserLogin</span></span> | <span data-ttu-id="dbbca-223">AspnetUserLogins</span><span class="sxs-lookup"><span data-stu-id="dbbca-223">AspnetUserLogins</span></span> | <span data-ttu-id="dbbca-224">ProviderKey + UserId + LoginProvider</span><span class="sxs-lookup"><span data-stu-id="dbbca-224">ProviderKey+UserId + LoginProvider</span></span> | <span data-ttu-id="dbbca-225">UserId-&gt;AspnetUsers</span><span class="sxs-lookup"><span data-stu-id="dbbca-225">UserId-&gt;AspnetUsers</span></span> |
| <span data-ttu-id="dbbca-226">IdentityUserClaim</span><span class="sxs-lookup"><span data-stu-id="dbbca-226">IdentityUserClaim</span></span> | <span data-ttu-id="dbbca-227">AspnetUserClaims</span><span class="sxs-lookup"><span data-stu-id="dbbca-227">AspnetUserClaims</span></span> | <span data-ttu-id="dbbca-228">ID</span><span class="sxs-lookup"><span data-stu-id="dbbca-228">Id</span></span> | <span data-ttu-id="dbbca-229">User\_Id-&gt;AspnetUsers</span><span class="sxs-lookup"><span data-stu-id="dbbca-229">User\_Id-&gt;AspnetUsers</span></span> |

<span data-ttu-id="dbbca-230">이 정보를 사용 하 여 새 테이블을 만드는 SQL 문을 만들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-230">With this information we can create SQL statements to create new tables.</span></span> <span data-ttu-id="dbbca-231">각 문을 개별적으로 작성 하거나 필요에 따라 다음 편집 EntityFramework PowerShell 명령을 사용 하 여 전체 스크립트를 생성 했습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-231">We can either write each statement individually or generate the entire script using EntityFramework PowerShell commands which we can then edit as required.</span></span> <span data-ttu-id="dbbca-232">VS 열기에서이 작업을 수행 하는 **패키지 관리자 콘솔** 에서 합니다 **뷰** 또는 **도구** 메뉴</span><span class="sxs-lookup"><span data-stu-id="dbbca-232">To do this, in VS open the **Package Manager Console** from the **View** or **Tools** menu</span></span>

- <span data-ttu-id="dbbca-233">EntityFramework 마이그레이션을 사용 하도록 설정 하려면 "Enable-migrations" 명령을 실행 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-233">Run command "Enable-Migrations" to enable EntityFramework migrations.</span></span>
- <span data-ttu-id="dbbca-234">C#에서 데이터베이스를 만드는 초기 설치 코드를 만드는 "add-migration을 초기" 명령을 실행 / VB.</span><span class="sxs-lookup"><span data-stu-id="dbbca-234">Run command "Add-migration initial" which creates the initial setup code to create the database in C#/VB.</span></span>
- <span data-ttu-id="dbbca-235">마지막 단계로 실행 하는 것 "Update-database – 스크립트" 모델 클래스를 기반으로 SQL 스크립트를 생성 하는 명령입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-235">The final step is to run "Update-Database –Script" command that generates the SQL script based on the model classes.</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

<span data-ttu-id="dbbca-236">여기서 수도 있게 추가 변경 내용은 새 열을 추가 하 고 데이터 복사를 시작으로이 데이터베이스 생성 스크립트를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-236">This database generation script can be used as a start where we'll be making additional changes to add new columns and copy data.</span></span> <span data-ttu-id="dbbca-237">이의 장점은 생성 하는 것을 `_MigrationHistory` EntityFramework 모델 클래스 Identity 릴리스 이후 버전에 대 한 변경 하는 경우 데이터베이스 스키마를 수정 하려면 사용 되는 테이블입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-237">The advantage of this is that we generate the `_MigrationHistory` table which is used by EntityFramework to modify the database schema when the model classes change for future versions of Identity releases.</span></span> 

<span data-ttu-id="dbbca-238">SQL 멤버 자격 사용자 정보를 다른 뿐만 namely 전자 메일 Id 사용자 모델 클래스에서 속성, 암호 시도 횟수, 마지막 로그인 날짜, 마지막 잠금 날짜 등 했습니다. 유용한 정보 이며 Id 시스템에 전달 하 고 싶습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-238">The SQL membership user information had other properties in addition to the ones in the Identity user model class namely email, password attempts, last login date, last lock-out date etc. This is useful information and we would like it to be carried over to the Identity system.</span></span> <span data-ttu-id="dbbca-239">사용자 모델에 추가 속성을 추가 하 고 데이터베이스의 테이블 열에 다시 매핑할 수 여이 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-239">This can be done by adding additional properties to the user model and mapping them back to the table columns in the database.</span></span> <span data-ttu-id="dbbca-240">이렇게 할 클래스를 추가 하 여 해당 서브 클래스는 `IdentityUser` 모델입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-240">We can do this by adding a class that subclasses the `IdentityUser` model.</span></span> <span data-ttu-id="dbbca-241">이 사용자 지정 클래스에 속성을 추가 하 고 테이블을 만들 때 해당 열을 추가 하려면 SQL 스크립트를 편집할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-241">We can add the properties to this custom class and edit the SQL script to add the corresponding columns when creating the table.</span></span> <span data-ttu-id="dbbca-242">이 클래스에 대 한 코드는 문서에 자세히 설명 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-242">The code for this class is described further in the article.</span></span> <span data-ttu-id="dbbca-243">만들기 위한 SQL 스크립트를 `AspnetUsers` 테이블 수는 새 속성 추가</span><span class="sxs-lookup"><span data-stu-id="dbbca-243">The SQL script for creating the `AspnetUsers` table after adding the new properties would be</span></span>

[!code-sql[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample1.sql)]

<span data-ttu-id="dbbca-244">다음 Id에 대 한 기존 정보를 SQL 멤버 자격 데이터베이스에서 새로 추가 된 테이블을 복사 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-244">Next we need to copy the existing information from the SQL membership database to the newly added tables for Identity.</span></span> <span data-ttu-id="dbbca-245">이 다른 테이블에서 직접 데이터를 복사 하 여 SQL을 통해 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-245">This can be done through SQL by copying data directly from one table to another.</span></span> <span data-ttu-id="dbbca-246">테이블의 행에 데이터를 추가 하려면 사용 된 `INSERT INTO [Table]` 생성 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-246">To add data into the rows of table, we use the `INSERT INTO [Table]` construct.</span></span> <span data-ttu-id="dbbca-247">사용 하 여 다른 테이블에서 복사 하는 `INSERT INTO` 문을 함께 `SELECT` 문입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-247">To copy from another table we can use the `INSERT INTO` statement along with the `SELECT` statement.</span></span> <span data-ttu-id="dbbca-248">쿼리 하는 데 필요한 모든 사용자 정보를 가져오려고 합니다 *aspnet\_사용자* 및 *aspnet\_멤버 자격* 테이블과 데이터를 복사 합니다 *AspNetUsers*테이블입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-248">To get all the user information we need to query the *aspnet\_Users* and *aspnet\_Membership* tables and copy the data to the *AspNetUsers* table.</span></span> <span data-ttu-id="dbbca-249">사용 하 여는 `INSERT INTO` 하 고 `SELECT` 와 함께 `JOIN` 및 `LEFT OUTER JOIN` 문입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-249">We use the `INSERT INTO` and `SELECT` along with `JOIN` and `LEFT OUTER JOIN` statements.</span></span> <span data-ttu-id="dbbca-250">쿼리 및 테이블 간에 데이터를 복사 하는 방법에 대 한 자세한 내용은 참조 [이](https://technet.microsoft.com/library/ms190750%28v=sql.105%29.aspx) 링크 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-250">For more information about querying and copying data between tables, refer to [this](https://technet.microsoft.com/library/ms190750%28v=sql.105%29.aspx) link.</span></span> <span data-ttu-id="dbbca-251">또한 AspnetUserLogins 테이블과 AspnetUserClaims 않으므로 빈 시작 하려면 기본적으로이 매핑되는 SQL 멤버 자격 정보가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-251">Additionally the AspnetUserLogins and AspnetUserClaims tables are empty to begin with since there is no information in SQL membership that maps to this by default.</span></span> <span data-ttu-id="dbbca-252">사용자 및 역할에 대 한 정보만 복사 됩니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-252">The only information copied is for users and roles.</span></span> <span data-ttu-id="dbbca-253">이전 단계에서 만든 프로젝트를 사용자 테이블에 정보를 복사할 SQL 쿼리가 됩니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-253">For the project created in the previous steps, the SQL query to copy information to the users table would be</span></span>

[!code-sql[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample2.sql)]

<span data-ttu-id="dbbca-254">위의 SQL 문에서 각 사용자에 대 한 정보를 *aspnet\_사용자가* 하 고 *aspnet\_멤버 자격* 테이블의 열으로 복사 됩니다는  *AspnetUsers* 테이블입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-254">In the above SQL statement, information about each user from the *aspnet\_Users* and *aspnet\_Membership* tables is copied into the columns of the *AspnetUsers* table.</span></span> <span data-ttu-id="dbbca-255">여기서만 수정 경우 암호를 복사 하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-255">The only modification done here is when we copy the password.</span></span> <span data-ttu-id="dbbca-256">SQL 멤버 자격에는 암호에 대 한 암호화 알고리즘 사용 'PasswordSalt' 및 'PasswordFormat' 않으므로 복사 하는 너무 해시 된 암호와 함께 Id로 암호 해독을 위한 사용 될 수 있도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-256">Since the encryption algorithm for passwords in SQL membership used 'PasswordSalt' and 'PasswordFormat', we copy that too along with the hashed password so that it can be used to decrypt the password by Identity.</span></span> <span data-ttu-id="dbbca-257">이 사용자 지정 암호 hasher를 후크 하는 경우 문서의 내용을 설명 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-257">This is explained further in the article when hooking up a custom password hasher.</span></span> 

<span data-ttu-id="dbbca-258">이 스크립트 파일은이 샘플에 특정 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-258">This script file is specific to this sample.</span></span> <span data-ttu-id="dbbca-259">추가 테이블을 포함 하는 응용 프로그램의 경우 사용자 모델 클래스에 추가 속성을 추가 하 고 AspnetUsers 테이블의 열에 매핑할 비슷한 방식이 개발자를 따르면 됩니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-259">For applications which have additional tables, developers can follow a similar approach to add additional properties on the user model class and map them to columns in the AspnetUsers table.</span></span> <span data-ttu-id="dbbca-260">스크립트를 실행 하려면</span><span class="sxs-lookup"><span data-stu-id="dbbca-260">To run the script,</span></span>

1. <span data-ttu-id="dbbca-261">서버 탐색기를 엽니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-261">Open Server Explorer.</span></span> <span data-ttu-id="dbbca-262">테이블을 표시 하려면 'ApplicationServices' 연결을 확장 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-262">Expand the 'ApplicationServices' connection to display the tables.</span></span> <span data-ttu-id="dbbca-263">테이블 노드를 마우스 오른쪽 단추로 클릭 하 고 새 쿼리 옵션을 선택</span><span class="sxs-lookup"><span data-stu-id="dbbca-263">Right click on the Tables node and select the 'New Query' option</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image7.png)
2. <span data-ttu-id="dbbca-264">쿼리 창에서 복사한 Migrations.sql 파일에서 전체 SQL 스크립트를 붙여 넣습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-264">In the query window, copy and paste the entire SQL script from the Migrations.sql file.</span></span> <span data-ttu-id="dbbca-265">'실행' 화살표 단추를 눌러 스크립트 파일을 실행 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-265">Run the script file by hitting the 'Execute' arrow button.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image4.jpg)

    <span data-ttu-id="dbbca-266">서버 탐색기 창을 새로 고칩니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-266">Refresh the Server Explorer window.</span></span> <span data-ttu-id="dbbca-267">데이터베이스에 5 개의 새 테이블이 만들어집니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-267">Five new tables are created in the database.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image8.png)

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image9.png)

    <span data-ttu-id="dbbca-268">다음 정보를 SQL 멤버 자격 테이블에 새 Id 시스템에 매핑되는 방식을입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-268">Below is how the information in the SQL membership tables are mapped to the new Identity system.</span></span>

    <span data-ttu-id="dbbca-269">aspnet\_역할-&gt; AspNetRoles</span><span class="sxs-lookup"><span data-stu-id="dbbca-269">aspnet\_Roles --&gt; AspNetRoles</span></span>

    <span data-ttu-id="dbbca-270">asp\_netUsers 및 asp\_netMembership-&gt; AspNetUsers</span><span class="sxs-lookup"><span data-stu-id="dbbca-270">asp\_netUsers and asp\_netMembership --&gt; AspNetUsers</span></span>

    <span data-ttu-id="dbbca-271">aspnet\_UserInRoles --&gt; AspNetUserRoles</span><span class="sxs-lookup"><span data-stu-id="dbbca-271">aspnet\_UserInRoles --&gt; AspNetUserRoles</span></span>

    <span data-ttu-id="dbbca-272">위의 섹션에서 설명 했 듯이 AspNetUserClaims AspNetUserLogins 테이블과 테이블은 비어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-272">As explained in the above section, the AspNetUserClaims and AspNetUserLogins tables are empty.</span></span> <span data-ttu-id="dbbca-273">AspNetUser 테이블의 '판별자' 필드에는 다음 단계로 정의 된 모델 클래스 이름과 일치 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-273">The 'Discriminator' field in the AspNetUser table should match the model class name which is defined as a next step.</span></span> <span data-ttu-id="dbbca-274">PasswordHash 열 형식에서 이기도 ' 암호화 된 암호 | 암호 솔트 | 암호 형식으로 '.</span><span class="sxs-lookup"><span data-stu-id="dbbca-274">Also the PasswordHash column is in the form 'encrypted password |password salt|password format'.</span></span> <span data-ttu-id="dbbca-275">이 옵션을 사용 하면 이전 암호를 다시 사용할 수 있도록 특수 SQL 멤버 자격 암호화 논리를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-275">This enables you to use special SQL membership crypto logic so that you can reuse old passwords.</span></span> <span data-ttu-id="dbbca-276">문서의 뒷부분에 설명 되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-276">That is explained in later in the article.</span></span>

### <a name="creating-models-and-membership-pages"></a><span data-ttu-id="dbbca-277">모델 및 멤버 자격 페이지 만들기</span><span class="sxs-lookup"><span data-stu-id="dbbca-277">Creating models and membership pages</span></span>

<span data-ttu-id="dbbca-278">앞에서 설명한 대로 Id 기능은 Entity Framework를 사용 하 여 기본적으로 계정 정보를 저장 하기 위한 데이터베이스와 통신 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-278">As mentioned earlier, the Identity feature uses Entity Framework to talk to the database for storing account information by default.</span></span> <span data-ttu-id="dbbca-279">테이블의 기존 데이터를 사용 하려면 테이블에 다시 매핑합니다 및 Id 시스템에 연결 하는 모델 클래스 만들기 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-279">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="dbbca-280">Identity 계약의 일부로 모델 클래스 Identity.Core dll에 정의 된 인터페이스를 구현 해야 하거나 또는 기존 구현의 Microsoft.AspNet.Identity.EntityFramework에서 사용할 수 있는 이러한 인터페이스를 확장할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-280">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span>

<span data-ttu-id="dbbca-281">이 샘플에서는 AspNetRoles, AspNetUserClaims, AspNetLogins 및 AspNetUserRole 테이블에는 Id 시스템의 기존 구현과 비슷합니다는 열입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-281">In our sample, the AspNetRoles, AspNetUserClaims, AspNetLogins and AspNetUserRole tables have columns that are similar to the existing implementation of the Identity system.</span></span> <span data-ttu-id="dbbca-282">따라서 이러한 테이블에 매핑하는 기존 클래스를 다시 사용할 수 했습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-282">Hence we can reuse the existing classes to map to these tables.</span></span> <span data-ttu-id="dbbca-283">AspNetUser 테이블에는 SQL 멤버 자격 테이블에서 추가 정보를 저장 하는 데 사용 되는 몇 개의 추가 열입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-283">The AspNetUser table has some additional columns which are used to store additional information from the SQL membership tables.</span></span> <span data-ttu-id="dbbca-284">'IdentityUser'의 기존 구현을 확장 및 추가 속성을 추가 하는 모델 클래스를 만들어이 매핑할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-284">This can be mapped by creating a model class that extend the existing implementation of 'IdentityUser' and add the additional properties.</span></span>

1. <span data-ttu-id="dbbca-285">연관 모델 프로젝트의 폴더에에서 사용자 클래스를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-285">Createa Models folder in the project and add a class User.</span></span> <span data-ttu-id="dbbca-286">클래스의 이름을 'AspnetUsers' 테이블의 '판별자' 열에 추가 된 데이터를 일치 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-286">The name of the class should match the data added in the 'Discriminator' column of 'AspnetUsers' table.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image10.png)

    <span data-ttu-id="dbbca-287">사용자 클래스를 IdentityUser 클래스를 확장 해야 합니다 *Microsoft.AspNet.Identity.EntityFramework* dll입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-287">The User class should extend the IdentityUser class found in the *Microsoft.AspNet.Identity.EntityFramework* dll.</span></span> <span data-ttu-id="dbbca-288">AspNetUser 열에 다시 매핑되는 클래스의 속성을 선언 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-288">Declare the properties in class that map back to the AspNetUser columns.</span></span> <span data-ttu-id="dbbca-289">속성 ID "," Username "," PasswordHash "및" SecurityStamp는 IdentityUser에 정의 되어 있고 따라서 생략 됩니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-289">The properties ID, Username, PasswordHash and SecurityStamp are defined in the IdentityUser and so are omitted.</span></span> <span data-ttu-id="dbbca-290">다음은 모든 속성이 포함 된 사용자 클래스에 대 한 코드</span><span class="sxs-lookup"><span data-stu-id="dbbca-290">Below is the code for the User class that has all the properties</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample3.cs)]
2. <span data-ttu-id="dbbca-291">Entity Framework DbContext 클래스를 다시 테이블에는 모델에서 데이터를 유지 하 고 모델을 채우는 테이블에서 데이터를 검색 하기 위해 필요 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-291">An Entity Framework DbContext class is required in order to persist data in models back to tables and retrieve data from tables to populate the models.</span></span> <span data-ttu-id="dbbca-292">*Microsoft.AspNet.Identity.EntityFramework* dll Identity 테이블 정보 검색 및 저장을 사용 하 여 상호 작용 하는 구체적인 IdentityDbContext 클래스를 정의 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-292">*Microsoft.AspNet.Identity.EntityFramework* dll defines the IdentityDbContext class which interacts with the Identity tables to retrieve and store information.</span></span> <span data-ttu-id="dbbca-293">구체적인 IdentityDbContext&lt;tuser&gt; IdentityUser 클래스를 확장 하는 클래스일 수 있는 'TUser' 클래스를 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-293">The IdentityDbContext&lt;tuser&gt; takes a 'TUser' class which can be any class that extends the IdentityUser class.</span></span>

    <span data-ttu-id="dbbca-294">ApplicationDBContext IdentityDbContext 1 단계에서 만든 'User' 클래스에 전달 '모델' 폴더를 확장 하는 새 클래스 만들기</span><span class="sxs-lookup"><span data-stu-id="dbbca-294">Create a new class ApplicationDBContext that extends IdentityDbContext under the 'Models' folder, passing in the 'User' class created in step 1</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample4.cs)]
3. <span data-ttu-id="dbbca-295">새 Id 시스템에 사용자 관리 이루어집니다 usermanager가 사용 하 여&lt;tuser&gt; 에 정의 된 클래스는 *Microsoft.AspNet.Identity.EntityFramework* dll입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-295">User management in the new Identity system is done using the UserManager&lt;tuser&gt; class defined in the *Microsoft.AspNet.Identity.EntityFramework* dll.</span></span> <span data-ttu-id="dbbca-296">UserManager를 1 단계에서 만든 'User' 클래스에서 전달 확장 하는 사용자 지정 클래스를 생성 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-296">We need to create a custom class that extends UserManager, passing in the 'User' class created in step 1.</span></span>

    <span data-ttu-id="dbbca-297">Models 폴더 UserManager UserManager를 확장 하는 새 클래스를 만듭니다&lt;사용자&gt;</span><span class="sxs-lookup"><span data-stu-id="dbbca-297">In the Models folder create a new class UserManager that extends UserManager&lt;user&gt;</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample5.cs)]
4. <span data-ttu-id="dbbca-298">응용 프로그램의 사용자의 암호는 암호화 되어 데이터베이스에 저장 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-298">The passwords of the users of the application are encrypted and stored in the database.</span></span> <span data-ttu-id="dbbca-299">SQL 멤버 자격에 사용 된 암호화 알고리즘은 새 Id 시스템에 것과에서 다릅니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-299">The crypto algorithm used in SQL membership is different from the one in the new Identity system.</span></span> <span data-ttu-id="dbbca-300">이전 암호 다시 사용 하려면 이전 사용자가 새 사용자에 대 한 id에서는 암호화 알고리즘을 사용 하는 동안 SQL 멤버 자격 알고리즘을 사용 하 여 로그인 하는 경우 선택적으로 암호를 해독 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-300">To reuse old passwords we need to selectively decrypt passwords when old users log in using the SQL memberships algorithm while using the crypto algorithm in Identity for the new users.</span></span>

    <span data-ttu-id="dbbca-301">Usermanager가 클래스에는 'IPasswordHasher' 인터페이스를 구현 하는 클래스의 인스턴스를 저장 하는 ' PasswordHasher' 속성이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-301">The UserManager class has a property 'PasswordHasher' which stores an instance of a class that implements the 'IPasswordHasher' interface.</span></span> <span data-ttu-id="dbbca-302">이 사용자 인증 트랜잭션 중 암호 암호화/해독에 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-302">This is used to encrypt/decrypt passwords during user authentication transactions.</span></span> <span data-ttu-id="dbbca-303">3 단계에서 정의한 UserManager 클래스에서 만드는 새 SQLPasswordHasher 및 복사 클래스는 아래 코드입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-303">In the UserManager class defined in step 3, create a new class SQLPasswordHasher and copy the below code.</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample6.cs)]

    <span data-ttu-id="dbbca-304">System.Text 및 System.Security.Cryptography 네임 스페이스를 가져와서 컴파일 오류를 해결 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-304">Resolve the compilation errors by importing the System.Text and System.Security.Cryptography namespaces.</span></span>

    <span data-ttu-id="dbbca-305">EncodePassword 메서드는 기본 SQL 멤버 자격 암호화 구현에 따라 암호를 암호화 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-305">The EncodePassword method encrypts the password according to the default SQL membership crypto implementation.</span></span> <span data-ttu-id="dbbca-306">System.Web dll에서 정보를 가져옵니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-306">This is taken from the System.Web dll.</span></span> <span data-ttu-id="dbbca-307">이전 앱 사용자 지정 구현을 사용 하는 경우 다음이 반영 되어야 합니다 여기 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-307">If the old app used a custom implementation then it should be reflected here.</span></span> <span data-ttu-id="dbbca-308">다른 두 메서드를 정의 해야 *HashPassword* 하 고 *VerifyHashedPassword* 사용 하는 합니다 *EncodePassword* 메서드를 지정 된 암호를 해시 또는 일반 텍스트를 확인 합니다. 데이터베이스에 하나의 기존 암호입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-308">We need to define two other methods *HashPassword* and *VerifyHashedPassword* that use the *EncodePassword* method to hash a given password or verify a plain text password with the one existing in the database.</span></span>

    <span data-ttu-id="dbbca-309">등록 또는 암호를 변경 시 사용자가 입력 한 암호를 해시 PasswordHash, PasswordSalt 및 PasswordFormat를 사용 하는 SQL 멤버 자격 시스템입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-309">The SQL membership system used PasswordHash, PasswordSalt and PasswordFormat to hash the password entered by users when they register or change their password.</span></span> <span data-ttu-id="dbbca-310">구분 하 여 AspNetUser 표에 PasswordHash 열에 저장 되는 세 개의 필드가 모두 마이그레이션하는 동안를 ' |' 문자입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-310">During the migration all the three fields are stored in the PasswordHash column in the AspNetUser table separated by the '|' character.</span></span> <span data-ttu-id="dbbca-311">사용자가 로그인 하는 경우 암호에 이러한 필드를 사용 하 여 SQL 멤버 자격 crypto; 암호 확인 그렇지 않은 경우 Id 시스템의 기본 암호화 암호를 확인 하려면 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-311">When a user logs in and the password has these fields, we use the SQL membership crypto to check the password; otherwise we use the Identity system's default crypto to verify the password.</span></span> <span data-ttu-id="dbbca-312">이러한 방식으로 이전 사용자 필요가 없습니다 앱 마이그레이션되면 자신의 암호를 변경 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-312">This way old users would not have to change their passwords once the app is migrated.</span></span>
5. <span data-ttu-id="dbbca-313">Usermanager가 클래스의 생성자를 선언 하 고는 SQLPasswordHasher 처럼 속성 생성자에 전달 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-313">Declare the constructor for the UserManager class and pass this as the SQLPasswordHasher to the property in the constructor.</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample7.cs)]

### <a name="create-new-account-management-pages"></a><span data-ttu-id="dbbca-314">새 계정 관리 페이지 만들기</span><span class="sxs-lookup"><span data-stu-id="dbbca-314">Create new account management pages</span></span>

<span data-ttu-id="dbbca-315">마이그레이션에 다음 단계를 등록 및 로그인 사용자 계정 관리 페이지를 추가 하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-315">The next step in the migration is to add account management pages that will let a user register and log in.</span></span> <span data-ttu-id="dbbca-316">SQL 멤버 자격에서 이전 계정 페이지를 새 Id 시스템을 사용 하지 않는 컨트롤을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-316">The old account pages from SQL membership use controls that don't work with the new Identity system.</span></span> <span data-ttu-id="dbbca-317">새 사용자를 추가 하려면 관리 페이지는이 링크의 자습서를 따르세요 [ https://www.asp.net/identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project ](../getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project.md)' 응용 프로그램에 사용자를 등록 하기 위한 웹 양식 추가 ' 단계에서 시작 되므로 이미 프로젝트를 생성 하 고 NuGet 추가 패키지입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-317">To add the new user management pages follow the tutorial at this link [https://www.asp.net/identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project](../getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project.md) starting from the step 'Adding Web Forms for registering users to your application' since we have already created the project and added the NuGet packages.</span></span>

<span data-ttu-id="dbbca-318">여기 프로젝트와 함께 작동 하도록이 샘플에 대 한 일부 변경 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-318">We need to make some changes for the sample to work with the project we have here.</span></span>

- <span data-ttu-id="dbbca-319">Register.aspx.cs 및 Login.aspx.cs 코드 숨김 클래스 사용의 `UserManager` 사용자를 만들려면 Identity 패키지에서 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-319">The Register.aspx.cs and Login.aspx.cs code behind classes use the `UserManager` from the Identity packages to create a User.</span></span> <span data-ttu-id="dbbca-320">이 예제에서는 앞에서 언급 한 단계에 따라 Models 폴더에 추가 합니다. UserManager를 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-320">For this example use the UserManager added in the Models folder by following the steps mentioned earlier.</span></span>
- <span data-ttu-id="dbbca-321">클래스 뒤 Register.aspx.cs 및 Login.aspx.cs 코드에서 IdentityUser 대신 생성 하는 사용자 클래스를 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-321">Use the User class created instead of the IdentityUser in Register.aspx.cs and Login.aspx.cs code behind classes.</span></span> <span data-ttu-id="dbbca-322">이 사용자 지정 클래스에서 Id 시스템에 연결 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-322">This hooks in our custom user class into the Identity system.</span></span>
- <span data-ttu-id="dbbca-323">데이터베이스를 만드는 부분을 건너뛸 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-323">The part to create the database can be skipped.</span></span>
- <span data-ttu-id="dbbca-324">개발자를 현재 응용 프로그램 ID와 일치 하는 새 사용자에 대 한 응용 프로그램 Id를 설정 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-324">The developer needs to set the ApplicationId for the new user to match the current application ID.</span></span> <span data-ttu-id="dbbca-325">이 Register.aspx.cs 클래스에서 사용자 개체를 만들기 전에이 응용 프로그램에 대 한 응용 프로그램 Id를 쿼리 및 사용자를 만들기 전에 설정 하 여 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-325">This can be done by querying the ApplicationId for this application before a user object is created in the Register.aspx.cs class and setting it before creating user.</span></span> 

    <span data-ttu-id="dbbca-326">예제:</span><span class="sxs-lookup"><span data-stu-id="dbbca-326">Example:</span></span>

    <span data-ttu-id="dbbca-327">Aspnet 쿼리 Register.aspx.cs 페이지에는 메서드를 정의\_응용 프로그램 테이블 및 응용 프로그램 이름에 따라 응용 프로그램 Id 가져오기</span><span class="sxs-lookup"><span data-stu-id="dbbca-327">Define a method in Register.aspx.cs page to query the aspnet\_Applications table and get the application Id according to application name</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample8.cs)]

    <span data-ttu-id="dbbca-328">이제 get이 개체에 설정 사용자</span><span class="sxs-lookup"><span data-stu-id="dbbca-328">Now get set this on the user object</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="dbbca-329">이전 사용자 이름 및 암호를 사용 하 여 기존 사용자를 로그인 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-329">Use the old username and password to login an existing user.</span></span> <span data-ttu-id="dbbca-330">등록 페이지를 사용 하 여 새 사용자를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-330">Use the Register page to create a new user.</span></span> <span data-ttu-id="dbbca-331">또한 예상 대로 사용자 역할에는 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-331">Also verify that the users are in roles as expected.</span></span>

<span data-ttu-id="dbbca-332">Id 시스템에 이식 Open Authentication (OAuth) 응용 프로그램에 추가 하는 사용자는 데 도움이 됩니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-332">Porting to the Identity system helps the user add Open Authentication (OAuth) to the application.</span></span> <span data-ttu-id="dbbca-333">샘플을 참조 하십시오 [여기](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/) OAuth가 설정 된 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-333">Please refer to the sample [here](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SQLMembership-Identity-OWIN/) which has OAuth enabled.</span></span>

## <a name="next-steps"></a><span data-ttu-id="dbbca-334">다음 단계</span><span class="sxs-lookup"><span data-stu-id="dbbca-334">Next Steps</span></span>

<span data-ttu-id="dbbca-335">이 자습서에서는 ASP.NET Id를 SQL 멤버 자격에서 사용자를 이식 하는 방법을 살펴보았습니다 하지만 프로필 데이터를 이식 하지 않은 것입니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-335">In this tutorial we showed how to port users from SQL membership to ASP.NET Identity, but we didn't port Profile data.</span></span> <span data-ttu-id="dbbca-336">다음 자습서에서 새 Id 시스템에 SQL 멤버 자격의 프로필 데이터를 이식에 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-336">In the next tutorial we'll look into porting Profile data from SQL membership to the new Identity system.</span></span>

<span data-ttu-id="dbbca-337">이 문서의 맨 아래에 의견을 남길 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="dbbca-337">You can leave feedback at the bottom of this article.</span></span>

<span data-ttu-id="dbbca-338">*Tom Dykstra 및 Rick Anderson의 문서를 검토에 참여해 주셔서 감사 합니다.*</span><span class="sxs-lookup"><span data-stu-id="dbbca-338">*Thanks to Tom Dykstra and Rick Anderson for reviewing the article.*</span></span>
